<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
<mapper namespace="com.pickme.beeze.mypage.dao.MypageDao">
 
	<!-- 찜 -->
<!-- 찜 추가 -->
<insert id="addSave" parameterType="com.pickme.beeze.mypage.dto.MypageSaveDto">
	insert into save(product_id, customer_id)
	values (#{productId}, #{customerId})
</insert>

<!-- 찜목록 가져오기 -->
<select id="getSave" resultType="com.pickme.beeze.mypage.dto.MypageSaveDto">
	select product_id as `productId`, customer_id as `customerId`
	  from save
</select>

<!-- 찜목록 삭제 -->
<delete id="delSave" parameterType="com.pickme.beeze.mypage.dto.MypageSaveDto">
	delete from save
	 where product_id = #{productId} and customer_id = #{customerId}
</delete>

	<!-- 리뷰 -->
<!-- 리뷰추가 -->
<insert id="addReview" parameterType="com.pickme.beeze.mypage.dto.MypageReviewDto">
insert into review(product_id, customer_id, content, rating)
values(#{productId}, #{customerId}, #{content}, #{rating})
</insert>

<!-- 리뷰보기 -->
<select id="getReview" parameterType="com.pickme.beeze.mypage.dto.MypageReviewDto" resultType="com.pickme.beeze.mypage.dto.MypageReviewDto">
	select product_id, content, rating
	  from review
	 where customer_id = #{customerId}
</select>

<!-- 리뷰삭제 -->
<delete id="delReview" parameterType="com.pickme.beeze.mypage.dto.MypageReviewDto">
	delete from review
	 where customer_id = #{customerId} and product_id = #{productId}
</delete>

	<!-- 장바구니 -->
<!-- 장바구니 목록보기 -->
<select id="getCart" resultType="com.pickme.beeze.mypage.dto.MypageCartDto"> 
	<!-- order_yn [0 == 결제완료전 / 1 == 결제완료] -->
	select customer_id, s_product_id
	  from cart
	 where order_yn = 0
</select>

<!-- 장바구니 목록삭제 -->
<delete id="delCart" parameterType="com.pickme.beeze.mypage.dto.MypageCartDto">
	delete from cart
	 where customer_id = #{customerId} and s_product_id = #{sProductId}
</delete>

	<!-- 개인정보 관리  -->
<!-- 개인정보 보기 포인트는 이것을 통해서 보기-->
<select id="getUserInfo" parameterType="com.pickme.beeze.mypage.dto.MypageCustomerDto" resultType="com.pickme.beeze.mypage.dto.MypageCustomerDto">
	select email, pw, name, address, phone, point, grade
	  from customer_info
	 where id = #{id}
	 <!-- id = customer_id -->
</select>

<!-- 개인정보 수정 -->
<update id="updateUserInfo" parameterType="com.pickme.beeze.mypage.dto.MypageCustomerDto">
	update customer_info
	   set email = #{email}, pw = #{pw}, name = #{name}, address = #{address}, phone = #{phone}
	 where id = #{id}
</update>

	<!-- 포인트 및 쿠폰 -->
<!-- 내 포인트 적립/차감하기 -->
<update id="updatePoint" parameterType="com.pickme.beeze.mypage.dto.MypageCustomerDto">
	update customer_info
	   set point = #{point}
	 where id = #{id}
</update>

<!-- 내 쿠폰 보기 -->
<select id="getCoupon" parameterType="com.pickme.beeze.mypage.dto.MypageCouponDto" resultType="com.pickme.beeze.mypage.dto.MypageCouponDto">
	select content, start_date as `startDate`, end_date as `endDate`
	  from coupon
	 where user_id = #{id}
</select>


</mapper>