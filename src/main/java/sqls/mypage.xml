<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
<mapper namespace="com.pickme.beeze.mypage.dao.MypageDao">
 
	<!-- 찜 -->
<!-- 찜 추가 -->
<insert id="addSave" parameterType="com.pickme.beeze.mypage.dto.MypageSaveDto">
	insert into save(product_id, customer_id)
	values (#{productId}, #{customerId})
</insert>

<!-- 찜목록 가져오기 -->
<select id="getSave" resultType="com.pickme.beeze.mypage.dto.MypageSaveDto">
	select product_id as `productId`, customer_id as `customerId`
	  from save
</select>

<!-- 찜목록 삭제 -->
<delete id="delSave" parameterType="com.pickme.beeze.mypage.dto.MypageSaveDto">
	delete from save
	 where product_id = #{productId} and customer_id = #{customerId}
</delete>

	<!-- 리뷰 -->
<!-- 리뷰추가 -->
<insert id="addReview" parameterType="com.pickme.beeze.mypage.dto.MypageReviewDto">
insert into review(product_id, customer_id, content, rating)
values(#{productId}, #{customerId}, #{content}, #{rating})
</insert>

<!-- 리뷰보기 -->
<select id="getReview" parameterType="com.pickme.beeze.mypage.dto.MypageReviewDto" resultType="com.pickme.beeze.mypage.dto.MypageReviewDto">
	select product_id, content, rating
	  from review
	 where customer_id = #{customerId}
</select>

<!-- 리뷰삭제 -->
<delete id="delReview" parameterType="com.pickme.beeze.mypage.dto.MypageReviewDto">
	delete from review
	 where customer_id = #{customerId} and product_id = #{productId}
</delete>

	<!-- 장바구니 -->
<!-- 장바구니 목록보기 -->
<select id="getCart" resultType="com.pickme.beeze.mypage.dto.MypageCartDto"> 
	<!-- order_yn [0 == 결제완료전 / 1 == 결제완료] -->
	select customer_id, s_product_id
	  from cart
	 where order_yn = 0
</select>

<!-- 장바구니 목록삭제 -->
<delete id="delCart" parameterType="com.pickme.beeze.mypage.dto.MypageCartDto">
	delete from cart
	 where customer_id = #{customerId} and s_product_id = #{sProductId}
</delete>

	<!-- 개인정보 관리  -->
<!-- 개인정보 보기 포인트는 이것을 통해서 보기-->
<select id="getUserInfo" parameterType="com.pickme.beeze.mypage.dto.MypageCustomerDto" resultType="com.pickme.beeze.mypage.dto.MypageCustomerDto">
	select email, pw, name, address, phone, point, grade
	  from customer_info
	 where id = #{id}
	 <!-- id = customer_id -->
</select>

<!-- 개인정보 수정 -->
<update id="updateUserInfo" parameterType="com.pickme.beeze.mypage.dto.MypageCustomerDto">
	update customer_info
	   set email = #{email}, pw = #{pw}, name = #{name}, address = #{address}, phone = #{phone}
	 where id = #{id}
</update>

	<!-- 포인트 및 쿠폰 -->
<!-- 내 포인트 적립/차감하기 -->
<update id="updatePoint" parameterType="com.pickme.beeze.mypage.dto.MypageCustomerDto">
	update customer_info
	   set point = #{point}
	 where id = #{id}
</update>

<!-- 내 쿠폰 보기 -->
<select id="getCoupon" parameterType="com.pickme.beeze.mypage.dto.MypageCouponDto" resultType="com.pickme.beeze.mypage.dto.MypageCouponDto">
	select content, start_date as `startDate`, end_date as `endDate`
	  from coupon
	 where user_id = #{id}
</select>

	<!-- 1:1문의게시판 보기 -->
<!-- 1:1 문의 게시글 작성하기   -->
<!-- answer_yn 0: 답변완료 전, 1:답변완료 후 -->
<insert id="addCcbList" parameterType="com.pickme.beeze.manager.dto.CcbDto">
	insert into ccb(category, customer_id, title, content, create_at, answer_yn)
	values (#{category}, #{customerId}, #{title}, #{content}, now(), 0)
</insert>

<!-- 내 1:1 문의 게시판 불러오기 -->
<select id="getMyCcbList" parameterType="com.pickme.beeze.manager.dto.CcbDto" resultType="com.pickme.beeze.manager.dto.CcbDto">
	SELECT id, category, title, content, create_at as `createAt`, answer_yn as `answerYn`
	  FROM ccb
	 WHERE customer_id = #{custoemerId}
</select>

	<!-- 내 주문내역 -->
<!-- 내 주문내역 불러오기 -->
<!-- id 주문번호 / cartId 카트번호 / date 날짜 / cancelYn 결제취소 / sProductId 제품번호 / quantity 수량 -->
<select id="getMyOrderList" parameterType="MypageOrderDto" resultType="MypageOrderDto">
	SELECT id, e.cart_id as `cartId`, date, cancel_yn as `cancelYn`, s_product_id as `sProductId`, quantity
	  FROM order o INNER JOIN cart c
	    ON e.cart_id = c.id
	 WHERE c.customer_id = #{customerId} and order_yn = 1
</select>

<!-- sProductID 를 통해 상품정보 까지 불러오기 -->
<!-- storeId 점포번호 / expDate 제품소비기한 / name 상품명 / price 가격 -->
<select id="getMYOrderProduct" parameterType="MypageOrderDto" resultType="MypageOrderDto">
	SELECT s.store_id as `storeId` s.exp_date as `expDate` name, price
	  FROM store_product s INNER JOIN product p
	    ON s.product_id = p.id
	 WHERE id = #{sProductId}
</select>

<!-- storeId 를 통해서 점포이름 및 위치 가져오기 -->
<!-- storeName 점포이름 / lat 위도 / lon 경도 / tel 전화번호 -->
<select id="getMyOrderStore" parameterType="MypageOrderDto" resultType="MypageOrderDto">
	SELECT name as `storeName`, lat, lon, tel
	  FROM store
	 WHERE id = #{storeId}
</select>

<!-- 내 주문 취소 -->
<update id="cancelMyOrder" parameterType="MypageOrderDto">
	UPDATE order 
	   SET cancel_yn = 1
	 WHERE customer_id = #{customerId}
</update>

</mapper>